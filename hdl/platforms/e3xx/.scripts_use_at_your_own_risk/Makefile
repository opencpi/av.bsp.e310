# This file is protected by Copyright. Please refer to the COPYRIGHT file
# distributed with this source distribution.
#
# This file is part of OpenCPI <http://www.opencpi.org>
#
# OpenCPI is free software: you can redistribute it and/or modify it under the
# terms of the GNU Lesser General Public License as published by the Free
# Software Foundation, either version 3 of the License, or (at your option) any
# later version.
#
# OpenCPI is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
# A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
# details.
#
# You should have received a copy of the GNU Lesser General Public License along
# with this program. If not, see <http://www.gnu.org/licenses/>.

Configurations=\
   base \

# Add Configurations
AllConfigModes=0 1 2 3 4 5 6

ConfigModes=2

# Custom configrations is a list of all configurations that
# can be generated by create_cfgs.py. If arg-1 is provided,
# it lists the chosen ConfigModes to limit this to (instead
# of just using all of them).
CustomConfigurations=$(strip \
  $(foreach r,0 1 2,\
    $(foreach t,0 1 2,\
      $(if $(or $(filter-out 0,$r),$(filter-out 0,$t)),\
        $(foreach m,$(or $1,$(AllConfigModes)),\
          cfg_$(r)rx_$(t)tx_mode_$(m)_cmos)))))

# Append the per-mode configurations to our list
Configurations+=$(call CustomConfigurations,$(ConfigModes))
#
# If the most basic config file doesn't exist, regenerate them all
ifeq ($(filter cfgfiles,$(MAKECMDGOALS))$(filter clean%,$(MAKECMDGOALS)),)
  $(shell test -e cfg_1rx_0tx_mode_2_cmos.xml || ./create_cfgs.py $(ConfigModes))
endif

all: cfgfiles

# make rule to recreate config files
cfgfiles: $(wildcard template-configs/*.xml) create_cfgs.py e3xx.xdc e3xx_timing.xdc
	$(AT)./create_cfgs.py $(ConfigModes)

clean: cleanconfigs

# remove generated config files
cleanconfigs:
	$(AT)rm -f $(CustomConfigurations:%=%.xml);
	$(AT)for m in $(AllConfigModes); do \
	       rm -f e3xx_mimo_xcvr_mode_$${m}_cmos.xdc; \
	     done
